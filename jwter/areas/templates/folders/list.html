{% extends 'base.html' %}

{% load static %}
{% load paginator %}

{% block js %}
    {{ block.super }}
    <script>
        URL = {
            folder_rename: function (folder_id) {
                return '{% url folder-rename 12345 %}'.replace('12345', folder_id)
            }
        }
        csrftoken = '{{ csrf_token }}'
    </script>
    <script src="{% static 'folders/list.js' %}"></script>
{% endblock %}

{% block content %}
    {% include 'folders/folders_tabs.html' %}

    <div>
        {% if perms.areas.add_folder %}
            <form method="POST" action="{% url folder-new %}" class="folder-new-form pull-right">
                {% csrf_token %}
                <input type="hidden" name="name" />
                <button class="btn btn-primary new-folder">Новая папка</button>
            </form>
        {% endif %}

        <h3>Папки</h3>
    </div>

    <div class="clearfix"></div>

    <table class="table folders-list">
        <thead>
            <tr>
                <th>Название</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for f in folder_list %}
                <tr>
                    <td>
                        {% if f.is_inbox or not perms.areas.change_folder %}
                            {{ f.name }}
                        {% else %}
                            <a href="#" class="folders-list-link" folder-id="{{ f.id }}">{{ f.name }}</a>
                            <form method="POST" action="{% url folder-rename pk=f.id %}">
                                {% csrf_token %}
                                <input type="hidden" name="new_name" />
                            </form>
                        {% endif %}
                    </td>

                    <td>
                        {% if perms.areas.delete_folder and not f.is_inbox %}
                            <form method="POST" action="{% url folder-delete f.id %}">
                                {% csrf_token %}
                                <button class="btn btn-danger btn-xs">Удалить</button>
                            </form>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
